version: v1.0
name: Simplificator Ansible Caddy Role
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804

blocks:
  - name: "Test"
    task:
      jobs:
      - name: Test role
        matrix:
        - env_var: DOCKER_FILE
          values: [ "Dockerfile-test-ubuntu1804", "Dockerfile-test-debian10" ]
        - env_var: ANSIBLE_PLAYBOOK
          values: [ "provision-test-installation", "provision-test-proxy" ]
        commands:
          - checkout
          - docker build --file test/$DOCKER_FILE --build-arg playbook=$ANSIBLE_PLAYBOOK .
